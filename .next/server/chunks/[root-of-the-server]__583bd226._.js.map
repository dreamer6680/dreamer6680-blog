{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///D:/code/web/fumadco/my/app/api/meta/route.ts"],"sourcesContent":["import type { NextRequest } from 'next/server';\r\nimport { NextResponse } from 'next/server';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\n\r\nconst docsRoot = path.resolve(process.cwd(), 'content/docs');\r\n\r\nfunction isInvalidPage(str: string): boolean {\r\n  if (!str || typeof str !== 'string') return true;\r\n  if (/\\[.*?\\]\\(.*?\\)/.test(str) || /^https?:\\/\\//.test(str) || /[()]/.test(str)) return true;\r\n  if (/^\\s*---[\\s\\S]*---\\s*$/.test(str)) return true;\r\n  return false;\r\n}\r\n\r\nfunction getPageName(str: string): string {\r\n  return str.startsWith('...') ? str.slice(3) : str;\r\n}\r\n\r\nasync function findFirstValidPage(dirRelPath: string): Promise<string | null> {\r\n  const absDir = path.join(docsRoot, dirRelPath);\r\n  const metaPath = path.join(absDir, 'meta.json');\r\n\r\n  try {\r\n    const metaRaw = await fs.readFile(metaPath, 'utf-8');\r\n    const meta = JSON.parse(metaRaw);\r\n    if (!Array.isArray(meta.pages)) return null;\r\n\r\n    for (const page of meta.pages) {\r\n      if (isInvalidPage(page)) continue;\r\n\r\n      const pageName = getPageName(page);\r\n      const pagePath = path.join(dirRelPath, pageName);\r\n\r\n      const candidateDir = path.join(docsRoot, pagePath);\r\n      const candidateFile = candidateDir + '.mdx';\r\n\r\n      try {\r\n        await fs.access(candidateFile);\r\n        return pagePath;\r\n      } catch {\r\n        try {\r\n          const stat = await fs.stat(candidateDir);\r\n          if (stat.isDirectory()) {\r\n            const recursiveResult = await findFirstValidPage(pagePath);\r\n            if (recursiveResult) return recursiveResult;\r\n          }\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const url = new URL(req.url);\r\n  const rawPath = url.searchParams.get('path');\r\n\r\n  if (!rawPath || !rawPath.startsWith('/docs')) {\r\n    return NextResponse.json({ error: 'Invalid path' }, { status: 400 });\r\n  }\r\n\r\n  // 去除 /docs 前缀，且清理首尾斜杠\r\n  const relPath = rawPath.replace(/^\\/docs\\/?/, '').replace(/^\\/|\\/$/g, '');\r\n\r\n  try {\r\n    // 先检测是否有该 mdx 文件\r\n    const maybeFile = path.join(docsRoot, relPath + '.mdx');\r\n    await fs.access(maybeFile);\r\n    // 如果存在，返回完整路径（带 /docs）\r\n    return NextResponse.json('/docs/' + relPath);\r\n  } catch {\r\n    // 不存在，尝试递归寻找第一个有效页面\r\n    const found = await findFirstValidPage(relPath);\r\n    if (found) {\r\n      // 返回带 /docs 前缀的完整路径\r\n      return NextResponse.json('/docs/' + found.replace(/\\\\/g, '/'));\r\n    } else {\r\n      return NextResponse.json({ error: 'No valid mdx page found' }, { status: 404 });\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AACA;AACA;AACA;;;;AAEA,MAAM,WAAW,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AAE7C,SAAS,cAAc,GAAW;IAChC,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU,OAAO;IAC5C,IAAI,iBAAiB,IAAI,CAAC,QAAQ,eAAe,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,MAAM,OAAO;IACvF,IAAI,wBAAwB,IAAI,CAAC,MAAM,OAAO;IAC9C,OAAO;AACT;AAEA,SAAS,YAAY,GAAW;IAC9B,OAAO,IAAI,UAAU,CAAC,SAAS,IAAI,KAAK,CAAC,KAAK;AAChD;AAEA,eAAe,mBAAmB,UAAkB;IAClD,MAAM,SAAS,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,UAAU;IACnC,MAAM,WAAW,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ;IAEnC,IAAI;QACF,MAAM,UAAU,MAAM,qHAAA,CAAA,UAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,MAAM,OAAO,KAAK,KAAK,CAAC;QACxB,IAAI,CAAC,MAAM,OAAO,CAAC,KAAK,KAAK,GAAG,OAAO;QAEvC,KAAK,MAAM,QAAQ,KAAK,KAAK,CAAE;YAC7B,IAAI,cAAc,OAAO;YAEzB,MAAM,WAAW,YAAY;YAC7B,MAAM,WAAW,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,YAAY;YAEvC,MAAM,eAAe,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,UAAU;YACzC,MAAM,gBAAgB,eAAe;YAErC,IAAI;gBACF,MAAM,qHAAA,CAAA,UAAE,CAAC,MAAM,CAAC;gBAChB,OAAO;YACT,EAAE,OAAM;gBACN,IAAI;oBACF,MAAM,OAAO,MAAM,qHAAA,CAAA,UAAE,CAAC,IAAI,CAAC;oBAC3B,IAAI,KAAK,WAAW,IAAI;wBACtB,MAAM,kBAAkB,MAAM,mBAAmB;wBACjD,IAAI,iBAAiB,OAAO;oBAC9B;gBACF,EAAE,OAAM;gBACN,SAAS;gBACX;YACF;QACF;IACF,EAAE,OAAM;IACN,SAAS;IACX;IAEA,OAAO;AACT;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;IAC3B,MAAM,UAAU,IAAI,YAAY,CAAC,GAAG,CAAC;IAErC,IAAI,CAAC,WAAW,CAAC,QAAQ,UAAU,CAAC,UAAU;QAC5C,OAAO,+PAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,sBAAsB;IACtB,MAAM,UAAU,QAAQ,OAAO,CAAC,cAAc,IAAI,OAAO,CAAC,YAAY;IAEtE,IAAI;QACF,iBAAiB;QACjB,MAAM,YAAY,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,UAAU,UAAU;QAChD,MAAM,qHAAA,CAAA,UAAE,CAAC,MAAM,CAAC;QAChB,uBAAuB;QACvB,OAAO,+PAAA,CAAA,eAAY,CAAC,IAAI,CAAC,WAAW;IACtC,EAAE,OAAM;QACN,oBAAoB;QACpB,MAAM,QAAQ,MAAM,mBAAmB;QACvC,IAAI,OAAO;YACT,oBAAoB;YACpB,OAAO,+PAAA,CAAA,eAAY,CAAC,IAAI,CAAC,WAAW,MAAM,OAAO,CAAC,OAAO;QAC3D,OAAO;YACL,OAAO,+PAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;IACF;AACF","debugId":null}}]
}