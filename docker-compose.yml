version: '3.8'

# 注意：使用docker-compose部署时，需要先登录阿里云容器镜像服务
# docker login ${ALIYUN_REGISTRY_URL} -u ${ALIYUN_REGISTRY_USERNAME} -p ${ALIYUN_REGISTRY_PASSWORD}
# 或者在运行时指定镜像标签
# docker-compose up -d --build

services:
  web:
    # 推荐使用环境变量方式指定镜像地址，或直接修改为固定地址
    # 示例：image: registry.cn-hangzhou.aliyuncs.com/your-namespace/fumadco-blog:latest
    image: ${ALIYUN_REGISTRY_URL:-registry.cn-hangzhou.aliyuncs.com}/${ALIYUN_NAMESPACE:-your-namespace}/fumadco-blog:latest
    restart: always
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      # 如果有其他环境变量，可以在这里添加
      # - NEXT_PUBLIC_API_URL=https://api.example.com
    volumes:
      - ./public:/app/public:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3